drop table if exists breach;
create table breach
(
    id             uuid not null
        constraint breach_pk primary key,
    sent_id        integer,
    sent_number    text,
    sent_date      timestamp,
    income_number  text,
    income_date    timestamp,
    eo_number      text,
    eo_date        timestamp,
    erdr_number    text,
    erdr_date      timestamp,
    erdr_article   text,
    method_id      integer not null,
    region_id      text not null,
    story          text,
    oper_info      text
);
alter table breach owner to postgres;

INSERT INTO breach.breach (id, sent_id, sent_number, sent_date, income_number, income_date, eo_number, eo_date, erdr_number, erdr_date, erdr_article, method_id, region_id, story, oper_info)VALUES ('8a719835-941d-48fa-b2dc-3d81c8023dfe', 11, '', null, '11', '2020-10-24 11:37:00.000000', '11', '2020-10-24 11:37:00.000000', '11', '2020-10-24 11:37:00.000000', '', 1, null, 'qqqqqqqqqqqqqqqqqqqqqq', null);
INSERT INTO breach.breach (id, sent_id, sent_number, sent_date, income_number, income_date, eo_number, eo_date, erdr_number, erdr_date, erdr_article, method_id, region_id, story, oper_info)VALUES ('ad428b8c-a0fe-4ee2-a716-657f0042d11c', 11, '', null, '11', '2020-10-10 11:35:00.000000', '11', '2020-10-24 11:35:00.000000', '11', '2020-10-24 11:35:00.000000', '', 2, null, '', null);

drop table if exists breach.person;
create table breach.person
(
    id          uuid not null
        constraint person_pk primary key,
    passport    text,
    last_name   text,
    first_name  text,
    middle_name text,
    birth_date  timestamp,
    region_id   text,
    city        text,
    street      text,
    house       text,
    apartment   text,
    email       text
);
alter table breach.person owner to postgres;

drop table if exists breach.participant;
create table breach.participant
(
    id                   uuid    not null
        constraint participant_pk primary key,
    breach_id            uuid    not null
        constraint participant_breach_id_fk
            references breach,
    participant_type_id  int     not null
        constraint participant_type_id_fk
            references participant_type,
    person_id            uuid
        constraint participant_person_id_fk
        references person
);
alter table breach.participant owner to postgres;

drop table if exists breach.participant_type;
create table breach.participant_type
(
    id          int    not null
        constraint participant_type_pk primary key,
    name        text   not null
);
alter table breach.participant_type owner to postgres;
insert into breach.participant_type values (1, 'Розшукувана особа');
insert into breach.participant_type values (2, 'Заявник');


drop table seized;
create table seized
(
    id             uuid not null
        constraint seized_pk primary key,
    breach_id      integer
);

alter table seized
    owner to postgres;



drop table device;
create table device
(
    id             uuid not null
        constraint device_pk primary key,
    type           integer,
    mac_address    bigint,
    imei1          bigint,
    imei2          bigint,
    ipv4           integer,
    ipv6_high      bigint,
    ipv6_low       bigint
);

alter table device
    owner to postgres;



drop table breach.bank_card;
create table breach.bank_card
(
    id             uuid not null
        constraint bank_card_pk primary key,
    card_number    text not null,
    bank_name      text,
    user_id        uuid,
    holder_id      uuid
);
alter table breach.bank_card owner to postgres;
INSERT INTO breach.bank_card (id, user_id, holder_id, bank_name, card_number) VALUES ('c5cd2cc2-a164-47d0-8834-77267a50999c', 'ad428b8c-a0fe-4ee2-a716-657f0042d11c', 'f65a21f1-2fa3-424c-9efc-b068dcdc4c7c', 'Приват', 1111111);

INSERT INTO breach.person (id, passport, last_name, first_name, middle_name, birth_date, region, city, street, house, apartment, email) VALUES ('f65a21f1-2fa3-424c-9efc-b068dcdc4c7c', 'CC111111', 'Петров', 'Петро', 'Петрович', '1986-10-24 12:38:11.000000', '00000000', 'Киев', 'Ленина', '20', '44', 'email@gmail.com');
INSERT INTO breach.person (id, passport, last_name, first_name, middle_name, birth_date, region, city, street, house, apartment, email) VALUES ('b1d974bb-3bef-45c7-91c2-3b8f34f417a4', 'CC222222', 'Иванов', 'Иван', 'Иванович', '1989-10-24 12:40:41.000000', '111111111', 'Чернигов', 'Кирова', '1', '222', null);


drop table breach.region;
create table breach.region
(
    id             text,
    name           text
);
alter table breach.region owner to postgres;

insert into breach.region(id, name)
select level1, name
FROM json_to_recordset((select value from breach.config where id = 'koatuu'))
         x(level1 text, level2 text, level3 text, level4 text, category text, name text)
where level2 = '';


drop table breach.config;
create table breach.config
(
    id         text,
    value      json
);
alter table breach.config owner to postgres;


drop table breach.method;
create table breach.method
(
    id   integer not null,
    name text    not null
);

alter table breach.method owner to postgres;

INSERT INTO breach.method (id, name) VALUES (1, 'Соцінженерія');
INSERT INTO breach.method (id, name) VALUES (2, 'Колл-центр');
INSERT INTO breach.method (id, name) VALUES (3, 'Телефонне шахрайство');
INSERT INTO breach.method (id, name) VALUES (4, 'Піраміда');